<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C.A.S.T - Lecturer Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    .sidebar-item:hover { background-color: rgba(255,255,255,0.1); }
    .submenu { max-height: 0; overflow: hidden; transition: max-height 0.3s; }
    .submenu.open { max-height: 1000px; }
    .rotate-90 { transform: rotate(90deg); }
    .active-route { background-color: rgba(255,255,255,0.2); }
    .file-card:hover { transform: translateY(-2px); }
    .loading-spinner { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div id="app" class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="w-64 bg-blue-900 text-white shadow-lg flex flex-col">
      <div class="p-6 border-b border-blue-800">
        <h1 class="text-2xl font-bold">C.A.S.T</h1>
        <p class="text-blue-200 text-sm">Lecturer Portal</p>
      </div>
      
      <nav class="p-4 flex-1 overflow-y-auto">
        <div class="mb-6">
          <h3 class="text-xs uppercase tracking-wider text-blue-400 mb-3">Core Modules</h3>
          <ul class="space-y-1">
            <li>
              <a href="#" @click="setActive('Dashboard')" class="flex items-center p-3 rounded-lg sidebar-item"
                 :class="{'active-route': activeRoute === 'Dashboard'}">
                <i class="fas fa-tachometer-alt mr-3"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="#" @click="setActive('Students')" class="flex items-center p-3 rounded-lg sidebar-item"
                 :class="{'active-route': activeRoute === 'Students'}">
                <i class="fas fa-users mr-3"></i>
                <span>Student Management</span>
              </a>
            </li>
            <li>
              <a href="#" @click="setActive('Assignments')" class="flex items-center p-3 rounded-lg sidebar-item"
                 :class="{'active-route': activeRoute === 'Assignments'}">
                <i class="fas fa-file-alt mr-3"></i>
                <span>Assignments</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="mb-6">
          <h3 class="text-xs uppercase tracking-wider text-blue-400 mb-3">Teaching Tools</h3>
          <ul class="space-y-1">
            <li>
              <a href="#" @click="setActive('AIScanner')" class="flex items-center p-3 rounded-lg sidebar-item"
                 :class="{'active-route': activeRoute === 'AIScanner'}">
                <i class="fas fa-search mr-3"></i>
                <span>AI Submission Scanner</span>
              </a>
            </li>
            <li>
              <a href="#" @click="setActive('LeaveAnalyzer')" class="flex items-center p-3 rounded-lg sidebar-item"
                 :class="{'active-route': activeRoute === 'LeaveAnalyzer'}">
                <i class="fas fa-calendar-check mr-3"></i>
                <span>Leave Analyzer</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
      
      <div class="p-4 border-t border-blue-800">
        <div class="flex items-center">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="h-8 w-8 rounded-full">
          <div class="ml-3">
            <p class="text-sm font-medium">Dr. Lecturer</p>
            <p class="text-xs text-blue-300">Computer Science Dept.</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <header class="bg-white shadow-sm">
        <div class="flex items-center justify-between p-4">
          <div>
            <h2 class="text-xl font-semibold text-gray-800">{{ activeRoute }}</h2>
            <p class="text-sm text-gray-500">{{ getCurrentToolDescription() }}</p>
          </div>
          <div class="flex space-x-4">
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
              <i class="fas fa-cog mr-1"></i> Settings
            </button>
          </div>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
        <!-- Dashboard View -->
        <div v-if="activeRoute === 'Dashboard'" class="bg-white rounded-lg shadow p-8 text-center">
          <h3 class="text-xl font-bold mb-2">Welcome to Lecturer Portal</h3>
          <p class="text-gray-600">Select a tool from the sidebar to begin</p>
        </div>

        <!-- AI Scanner View -->
        <div v-else-if="activeRoute === 'AIScanner'" class="bg-white rounded-lg shadow p-6">
          <div class="flex justify-between items-center mb-6">
            <div>
              <h3 class="text-xl font-bold">AI Submission Scanner</h3>
              <p class="text-gray-600">Analyze student submissions from database</p>
            </div>
            <button @click="fetchSubmissions" class="bg-blue-600 text-white px-4 py-2 rounded">
              <i class="fas fa-sync-alt mr-2"></i> Refresh
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium mb-1">Course</label>
              <select v-model="selectedCourse" class="w-full border rounded p-2">
                <option value="">All Courses</option>
                <option v-for="course in courses" :value="course.id">{{ course.name }}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Assignment</label>
              <select v-model="selectedAssignment" class="w-full border rounded p-2">
                <option value="">All Assignments</option>
                <option v-for="a in filteredAssignments" :value="a.id">{{ a.name }}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Sensitivity</label>
              <select v-model="sensitivity" class="w-full border rounded p-2">
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
          </div>

          <div v-if="loading" class="text-center py-8">
            <i class="fas fa-circle-notch loading-spinner text-blue-500 text-2xl"></i>
          </div>

          <div v-else-if="filteredSubmissions.length === 0" class="text-center py-8 text-gray-500">
            No submissions found
          </div>

          <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <div v-for="sub in filteredSubmissions" :key="sub.id" 
                 @click="toggleSelect(sub.id)"
                 class="file-card bg-white border-2 rounded-xl p-6 cursor-pointer hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
                 :class="{'border-purple-600 shadow-lg': selected.includes(sub.id), 'border-gray-200': !selected.includes(sub.id)}">
              <div class="flex items-start mb-4">
                <div class="flex-shrink-0">
                  <i :class="sub.type === 'pdf' ? 'fa-file-pdf text-red-500' : 'fa-file-word text-blue-500'" 
                     class="fas text-3xl mr-4"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <h4 class="font-bold text-lg text-gray-800 truncate mb-1">{{ sub.filename }}</h4>
                  <p class="text-sm font-medium text-purple-600 mb-1">{{ sub.course_name }}</p>
                  <p class="text-xs text-gray-400">{{ formatDate(sub.upload_date) }}</p>
                </div>
              </div>
              <div v-if="sub.scan_result" class="space-y-3">
                <div class="flex items-center justify-between">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold"
                        :class="getRiskClass(sub.scan_result.risk_level)">
                    <i class="fas fa-shield-alt mr-2"></i>
                    {{ sub.scan_result.risk_level }} Risk
                  </span>
                  <span class="text-lg font-bold text-gray-700">{{ sub.scan_result.ai_probability }}%</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-xs">
                  <div class="bg-green-50 p-2 rounded-lg">
                    <div class="font-semibold text-green-700">Human</div>
                    <div class="text-green-600">{{ 100 - sub.scan_result.ai_probability }}%</div>
                  </div>
                  <div class="bg-yellow-50 p-2 rounded-lg">
                    <div class="font-semibold text-yellow-700">AI Rewritten</div>
                    <div class="text-yellow-600">{{ sub.scan_result.ai_probability }}%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-if="filteredSubmissions.length > 0" class="mt-6 pt-4 border-t flex justify-between">
            <div>
              <button @click="selectAll" class="text-blue-600 text-sm">
                <i class="fas fa-check-square mr-1"></i> Select All
              </button>
              <button @click="selected = []" class="ml-4 text-gray-600 text-sm">
                <i class="fas fa-times-circle mr-1"></i> Clear
              </button>
            </div>
            <button @click="scanAllAssignments" :disabled="scanning" class="bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50">
              <i class="fas fa-search mr-2"></i> Scan All Assignments
            </button>
          </div>

          <!-- Assignments Table Below the Grid -->
          <div class="mt-10 bg-white rounded-xl shadow-lg p-6">
            <h4 class="text-xl font-bold mb-6 text-gray-800 flex items-center">
              <i class="fas fa-table mr-3 text-purple-600"></i>
              All Assignments in Database
            </h4>
            <div class="overflow-x-auto">
              <table class="min-w-full text-left border border-gray-200 rounded-lg overflow-hidden">
                <thead class="bg-gradient-to-r from-purple-600 to-purple-700 text-white">
                  <tr>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">ID</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Student</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Title</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Type</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Size</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">AI Words</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Human %</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">AI Rewritten %</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Other Feedback</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Action</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr v-if="assignments.length === 0" class="hover:bg-gray-50">
                    <td colspan="10" class="text-center text-gray-500 py-8">
                      <i class="fas fa-inbox text-4xl mb-2 text-gray-300"></i>
                      <p>No assignments found.</p>
                    </td>
                  </tr>
                  <tr v-for="a in assignments" :key="a.id" class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ a.id }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700">{{ a.student_id }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 font-medium">{{ a.title }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                            :class="a.file_ext === 'pdf' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'">
                        <i :class="a.file_ext === 'pdf' ? 'fas fa-file-pdf mr-1' : 'fas fa-file-word mr-1'"></i>
                        {{ a.file_ext.toUpperCase() }}
                      </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-700">{{ (a.file_size_bytes/1024).toFixed(1) }} KB</td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                      <span v-if="scanResults[a.id + '']?.loading" class="inline-flex items-center">
                        <i class="fas fa-circle-notch fa-spin text-purple-600 mr-2"></i>
                        Scanning...
                      </span>
                      <span v-else class="font-medium">{{ scanResults[a.id + '']?.aiWords ?? '-' }}</span>
                    </td>
                    <td class="px-6 py-4 text-sm">
                      <span v-if="scanResults[a.id + '']?.loading" class="inline-flex items-center">
                        <i class="fas fa-circle-notch fa-spin text-purple-600 mr-2"></i>
                        Scanning...
                      </span>
                      <span v-else class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        {{ scanResults[a.id + '']?.isHuman ?? '-' }}%
                      </span>
                    </td>
                    <td class="px-6 py-4 text-sm">
                      <span v-if="scanResults[a.id + '']?.loading" class="inline-flex items-center">
                        <i class="fas fa-circle-notch fa-spin text-purple-600 mr-2"></i>
                        Scanning...
                      </span>
                      <span v-else class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                        {{ scanResults[a.id + '']?.fakePercentage ?? '-' }}%
                      </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                      <span v-if="scanResults[a.id + '']?.loading" class="inline-flex items-center">
                        <i class="fas fa-circle-notch fa-spin text-purple-600 mr-2"></i>
                        Scanning...
                      </span>
                      <span v-else class="text-xs">{{ scanResults[a.id + '']?.otherFeedback ?? '-' }}</span>
                    </td>
                    <td class="px-6 py-4 text-sm">
                      <a :href="`http://localhost:5000/assignment/${a.id}/file`" target="_blank" 
                         class="inline-flex items-center px-3 py-1 rounded-md text-sm font-medium text-purple-700 bg-purple-100 hover:bg-purple-200 transition-colors">
                        <i class="fas fa-eye mr-1"></i>
                        View
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Leave Analyzer View -->
        <div v-else-if="activeRoute === 'LeaveAnalyzer'" class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-bold mb-4">Leave Analyzer</h3>
          <div class="bg-blue-50 p-4 rounded-lg mb-4">
            <h4 class="font-medium mb-2">Recommended Leave Periods</h4>
            <div class="space-y-2">
              <div class="flex items-center p-2 bg-white rounded">
                <i class="fas fa-calendar-check text-green-500 mr-2"></i>
                <span>May 15-30, 2024 (Optimal)</span>
              </div>
              <div class="flex items-center p-2 bg-white rounded">
                <i class="fas fa-calendar-alt text-yellow-500 mr-2"></i>
                <span>July 10-20, 2024 (Moderate)</span>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium mb-1">Start Date</label>
              <input type="date" class="w-full border rounded p-2">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">End Date</label>
              <input type="date" class="w-full border rounded p-2">
            </div>
          </div>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded font-medium">
            <i class="fas fa-paper-plane mr-2"></i> Submit Leave Request
          </button>
        </div>

        <!-- Assignments View -->
        <div v-else-if="activeRoute === 'Assignments'" class="bg-white rounded-lg shadow p-6">
          <div class="flex justify-between items-center mb-6">
            <div>
              <h3 class="text-xl font-bold text-gray-800">Assignment Management</h3>
              <p class="text-gray-600">Manage assignments and generate quizzes from uploaded PDFs</p>
            </div>
            <button @click="showQuizGenerator = true" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
              <i class="fas fa-question-circle mr-2"></i> Generate Quiz
            </button>
          </div>

          <!-- Quiz Generator Modal -->
          <div v-if="showQuizGenerator" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Generate Quiz from PDF</h3>
                <button @click="showQuizGenerator = false" class="text-gray-500 hover:text-gray-700">
                  <i class="fas fa-times text-xl"></i>
                </button>
              </div>

              <!-- PDF Selection -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select PDF Document</label>
                <select v-model="selectedPdfForQuiz" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                  <option value="">Choose a PDF document...</option>
                  <option v-for="assignment in pdfAssignments" :key="assignment.id" :value="assignment.id">
                    {{ assignment.title }} ({{ assignment.filename }})
                  </option>
                </select>
              </div>

              <!-- Quiz Settings -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Number of Questions</label>
                  <select v-model="quizSettings.questionCount" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="5">5 Questions</option>
                    <option value="10">10 Questions</option>
                    <option value="15">15 Questions</option>
                    <option value="20">20 Questions</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty Level</label>
                  <select v-model="quizSettings.difficulty" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                  </select>
                </div>
              </div>

              <!-- Quiz Type -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Quiz Type</label>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                  <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                    <input type="radio" v-model="quizSettings.type" value="multiple_choice" class="mr-3">
                    <div>
                      <div class="font-medium">Multiple Choice</div>
                      <div class="text-sm text-gray-500">Standard MCQ format</div>
                    </div>
                  </label>
                  <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                    <input type="radio" v-model="quizSettings.type" value="true_false" class="mr-3">
                    <div>
                      <div class="font-medium">True/False</div>
                      <div class="text-sm text-gray-500">Simple true or false</div>
                    </div>
                  </label>
                  <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                    <input type="radio" v-model="quizSettings.type" value="fill_blank" class="mr-3">
                    <div>
                      <div class="font-medium">Fill in the Blank</div>
                      <div class="text-sm text-gray-500">Complete missing words</div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Generate Button -->
              <div class="flex justify-end space-x-3">
                <button @click="showQuizGenerator = false" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                  Cancel
                </button>
                <button @click="generateQuiz" :disabled="!selectedPdfForQuiz || generatingQuiz" 
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed">
                  <i v-if="generatingQuiz" class="fas fa-spinner fa-spin mr-2"></i>
                  <i v-else class="fas fa-magic mr-2"></i>
                  {{ generatingQuiz ? 'Generating Quiz...' : 'Generate Quiz' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Generated Quiz Display -->
          <div v-if="generatedQuiz" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6 border border-green-200">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h4 class="text-xl font-bold text-gray-800 mb-2">Generated Quiz</h4>
                <p class="text-gray-600">Quiz generated from: {{ selectedPdfTitle }}</p>
              </div>
              <div class="flex space-x-2">
                <button @click="downloadQuiz" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                  <i class="fas fa-download mr-1"></i> Download
                </button>
                <button @click="shareQuiz" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                  <i class="fas fa-share mr-1"></i> Share
                </button>
              </div>
            </div>

            <!-- Quiz Preview -->
            <div class="bg-white rounded-lg p-6 border">
              <h5 class="font-bold text-lg mb-4">Quiz Preview</h5>
              <div v-for="(question, index) in generatedQuiz.questions" :key="index" class="mb-6 p-4 border border-gray-200 rounded-lg">
                <div class="font-medium text-gray-800 mb-2">
                  {{ index + 1 }}. {{ question.question }}
                </div>
                <div v-if="question.type === 'multiple_choice'" class="space-y-2">
                  <div v-for="(option, optIndex) in question.options" :key="optIndex" 
                       class="flex items-center p-2 rounded hover:bg-gray-50">
                    <input type="radio" :name="'q' + index" :value="optIndex" class="mr-3">
                    <span>{{ option }}</span>
                  </div>
                </div>
                <div v-else-if="question.type === 'true_false'" class="space-y-2">
                  <div class="flex items-center p-2 rounded hover:bg-gray-50">
                    <input type="radio" :name="'q' + index" value="true" class="mr-3">
                    <span>True</span>
                  </div>
                  <div class="flex items-center p-2 rounded hover:bg-gray-50">
                    <input type="radio" :name="'q' + index" value="false" class="mr-3">
                    <span>False</span>
                  </div>
                </div>
                <div v-else-if="question.type === 'fill_blank'" class="space-y-2">
                  <input type="text" :placeholder="'Fill in the blank: ' + question.placeholder" 
                         class="w-full border border-gray-300 rounded px-3 py-2">
                </div>
              </div>
            </div>
          </div>

          <!-- Assignments List -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h4 class="text-xl font-bold mb-6 text-gray-800 flex items-center">
              <i class="fas fa-file-alt mr-3 text-purple-600"></i>
              Available Assignments
            </h4>
            <div class="overflow-x-auto">
              <table class="min-w-full text-left border border-gray-200 rounded-lg overflow-hidden">
                <thead class="bg-gradient-to-r from-purple-600 to-purple-700 text-white">
                  <tr>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">ID</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Student</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Title</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Type</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Size</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Upload Date</th>
                    <th class="px-6 py-4 font-semibold text-sm uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr v-if="assignments.length === 0" class="hover:bg-gray-50">
                    <td colspan="7" class="text-center text-gray-500 py-8">
                      <i class="fas fa-inbox text-4xl mb-2 text-gray-300"></i>
                      <p>No assignments found.</p>
                    </td>
                  </tr>
                  <tr v-for="a in assignments" :key="a.id" class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ a.id }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700">{{ a.student_id }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 font-medium">{{ a.title }}</td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                            :class="a.file_ext === 'pdf' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'">
                        <i :class="a.file_ext === 'pdf' ? 'fas fa-file-pdf mr-1' : 'fas fa-file-word mr-1'"></i>
                        {{ a.file_ext.toUpperCase() }}
                      </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-700">{{ (a.file_size_bytes/1024).toFixed(1) }} KB</td>
                    <td class="px-6 py-4 text-sm text-gray-700">{{ formatDate(a.upload_date || new Date()) }}</td>
                    <td class="px-6 py-4 text-sm">
                      <div class="flex space-x-2">
                        <a :href="`http://localhost:5000/assignment/${a.id}/file`" target="_blank" 
                           class="inline-flex items-center px-3 py-1 rounded-md text-sm font-medium text-purple-700 bg-purple-100 hover:bg-purple-200 transition-colors">
                          <i class="fas fa-eye mr-1"></i>
                          View
                        </a>
                        <button v-if="a.file_ext === 'pdf'" @click="selectPdfForQuiz(a)" 
                                class="inline-flex items-center px-3 py-1 rounded-md text-sm font-medium text-green-700 bg-green-100 hover:bg-green-200 transition-colors">
                          <i class="fas fa-question-circle mr-1"></i>
                          Quiz
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Default View -->
        <div v-else class="bg-white rounded-lg shadow p-8 text-center">
          <h3 class="text-xl font-bold mb-2">{{ activeRoute }} View</h3>
          <p class="text-gray-600">Content will be displayed here</p>
        </div>
      </main>
    </div>
  </div>

  <script>
    const { createApp } = Vue;
    
    createApp({
      data() {
        return {
          activeRoute: 'Dashboard',
          // AI Scanner Data
          loading: false,
          submissions: [],
          selected: [],
          courses: [
            { id: 1, name: 'Computer Science 101' },
            { id: 2, name: 'Data Structures' },
            { id: 3, name: 'Algorithms' }
          ],
          selectedCourse: '',
          selectedAssignment: '',
          assignments: [],
          sensitivity: 'medium',
          scanResults: {},
          scanning: false,
          // Quiz Generator Data
          showQuizGenerator: false,
          selectedPdfForQuiz: '',
          selectedPdfTitle: '',
          generatingQuiz: false,
          generatedQuiz: null,
          quizSettings: {
            questionCount: '10',
            difficulty: 'medium',
            type: 'multiple_choice'
          }
        }
      },
      computed: {
        filteredSubmissions() {
          return this.submissions.filter(sub => {
            const courseMatch = !this.selectedCourse || sub.course_id === this.selectedCourse;
            const assignMatch = !this.selectedAssignment || sub.assignment_id === this.selectedAssignment;
            return courseMatch && assignMatch;
          });
        },
        filteredAssignments() {
          if (!this.selectedCourse) return this.assignments;
          return this.assignments.filter(a => a.course_id === this.selectedCourse);
        },
        pdfAssignments() {
          return this.assignments.filter(a => a.file_ext === 'pdf');
        }
      },
      methods: {
        setActive(route) {
          this.activeRoute = route;
        },
        getCurrentToolDescription() {
          const descriptions = {
            'Dashboard': 'Overview of your courses and activities',
            'AIScanner': 'Detect AI-generated content in student submissions',
            'LeaveAnalyzer': 'Optimize your leave schedule based on workload',
            'Students': 'Manage student information and progress',
            'Assignments': 'Manage and view student assignments'
          };
          return descriptions[this.activeRoute] || '';
        },
        // AI Scanner Methods
        async fetchSubmissions() {
          this.loading = true;
          try {
            // Simulate API call to PostgreSQL
            await new Promise(resolve => setTimeout(resolve, 800));
            this.submissions = [
              {
                id: 1,
                filename: 'assignment1.pdf',
                type: 'pdf',
                course_id: 1,
                course_name: 'Computer Science 101',
                assignment_id: 1,
                upload_date: '2023-10-15',
                size: '2.4MB',
                scan_result: { risk_level: 'high', ai_probability: 87 }
              },
              {
                id: 2,
                filename: 'project_report.docx',
                type: 'docx',
                course_id: 2,
                course_name: 'Data Structures',
                assignment_id: 3,
                upload_date: '2023-10-18',
                size: '1.8MB',
                scan_result: { risk_level: 'medium', ai_probability: 45 }
              }
            ];
          } catch (error) {
            console.error("Error fetching submissions:", error);
          } finally {
            this.loading = false;
          }
        },
        toggleSelect(id) {
          if (this.selected.includes(id)) {
            this.selected = this.selected.filter(s => s !== id);
          } else {
            this.selected.push(id);
          }
        },
        selectAll() {
          this.selected = this.filteredSubmissions.map(s => s.id);
        },
        async scanAllAssignments() {
          this.scanning = true;
          for (const a of this.assignments) {
            // Show loading indicator for this row
            this.scanResults = { ...this.scanResults, [a.id + '']: { loading: true } };
            try {
              const response = await fetch(`http://localhost:5000/scan_assignment/${a.id}`, { method: 'POST' });
              const data = await response.json();
              this.scanResults = { ...this.scanResults, [a.id + '']: data.result || { error: 'No result' } };
            } catch (error) {
              this.scanResults = { ...this.scanResults, [a.id + '']: { error: 'Scan failed' } };
            }
          }
          this.scanning = false;
        },
        formatDate(dateString) {
          return new Date(dateString).toLocaleDateString();
        },
        getRiskClass(risk) {
          return {
            'high': 'bg-red-100 text-red-800',
            'medium': 'bg-yellow-100 text-yellow-800',
            'low': 'bg-green-100 text-green-800'
          }[risk] || 'bg-gray-100 text-gray-800';
        },
        async fetchAssignments() {
          try {
            const response = await fetch('http://localhost:5000/assignments');
            if (!response.ok) throw new Error('Failed to fetch assignments');
            const data = await response.json();
            if (data.assignments) {
              this.assignments = data.assignments;
            } else {
              this.assignments = [];
              alert('No assignments found.');
            }
          } catch (error) {
            this.assignments = [];
            alert('Error loading assignments: ' + error.message);
            console.error('Error loading assignments:', error);
          }
        },
        // Quiz Generator Methods
        selectPdfForQuiz(assignment) {
          this.selectedPdfForQuiz = assignment.id;
          this.selectedPdfTitle = assignment.title;
          this.showQuizGenerator = true;
        },
        async generateQuiz() {
          if (!this.selectedPdfForQuiz) {
            alert('Please select a PDF document first.');
            return;
          }

          this.generatingQuiz = true;
          try {
            // Step 1: Get the PDF content from your backend
            const pdfResponse = await fetch(`http://localhost:5000/assignment/${this.selectedPdfForQuiz}/file`);
            if (!pdfResponse.ok) {
              throw new Error('Failed to fetch PDF content');
            }

            const pdfBlob = await pdfResponse.blob();
            
            // Step 2: Convert PDF to text using your backend
            const formData = new FormData();
            formData.append('pdf', pdfBlob, 'document.pdf');
            
            const textResponse = await fetch('http://localhost:5000/extract_text', {
              method: 'POST',
              body: formData
            });
            
            if (!textResponse.ok) {
              throw new Error('Failed to extract text from PDF');
            }
            
            const { text } = await textResponse.json();
            
            // Step 3: Call ProProfs API to generate quiz from text content
            try {
              const quizResponse = await fetch('http://localhost:5000/generate_quiz_gemini', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  text: text,
                  settings: this.quizSettings
                })
              });

              if (!quizResponse.ok) {
                throw new Error(`Gemini API error: ${quizResponse.status} ${quizResponse.statusText}`);
              }

              const quizData = await quizResponse.json();
              
              // Step 4: Process the API response
              this.generatedQuiz = this.processQuizResponse(quizData);
              
              this.showQuizGenerator = false;
              console.log('Quiz generated successfully from Gemini API:', quizData);
            } catch (apiError) {
              console.error('Error generating quiz with Gemini API:', apiError);
              alert('Error generating quiz: ' + apiError.message);
            }
          } catch (error) {
            console.error('Error generating quiz:', error);
            alert('Error generating quiz: ' + error.message);
          } finally {
            this.generatingQuiz = false;
          }
        },
        processQuizResponse(apiData) {
          // Process the ProProfs API response and format it for our UI
          const quiz = {
            title: `Quiz: ${this.selectedPdfTitle}`,
            description: `Generated quiz with ${this.quizSettings.questionCount} ${this.quizSettings.difficulty} level questions`,
            questions: [],
            settings: { ...this.quizSettings },
            generated_at: new Date().toISOString(),
            quiz_id: apiData.quiz_id || null,
            share_url: apiData.share_url || null
          };

          // Process questions based on API response structure
          if (apiData.questions && Array.isArray(apiData.questions)) {
            quiz.questions = apiData.questions.map((q, index) => ({
              id: index + 1,
              question: q.question || q.text || `Question ${index + 1}`,
              type: this.quizSettings.type,
              options: q.options || q.choices || [],
              correct_answer: q.correct_answer || q.answer || 0,
              explanation: q.explanation || ''
            }));
          } else if (apiData.content) {
            // If API returns content in a different format, parse it
            const lines = apiData.content.split('\n').filter(line => line.trim());
            let currentQuestion = null;
            
            lines.forEach(line => {
              if (line.match(/^\d+\./)) {
                if (currentQuestion) {
                  quiz.questions.push(currentQuestion);
                }
                currentQuestion = {
                  id: quiz.questions.length + 1,
                  question: line.replace(/^\d+\.\s*/, ''),
                  type: this.quizSettings.type,
                  options: [],
                  correct_answer: 0
                };
              } else if (currentQuestion && line.match(/^[a-d]\)/i)) {
                currentQuestion.options.push(line.replace(/^[a-d]\)\s*/i, ''));
              }
            });
            
            if (currentQuestion) {
              quiz.questions.push(currentQuestion);
            }
          }

          return quiz;
        },
        downloadQuiz() {
          if (!this.generatedQuiz) return;
          
          const quizData = JSON.stringify(this.generatedQuiz, null, 2);
          const blob = new Blob([quizData], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `quiz_${this.selectedPdfTitle.replace(/\s+/g, '_')}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        },
        shareQuiz() {
          if (!this.generatedQuiz) return;
          
          // Use the actual ProProfs URL if available from API response
          const quizUrl = this.generatedQuiz.share_url || 
                         `https://proprofs.com/quiz-school/quiz/${this.generatedQuiz.quiz_id || 'demo'}`;
          
          if (navigator.share) {
            navigator.share({
              title: this.generatedQuiz.title,
              text: this.generatedQuiz.description,
              url: quizUrl
            });
          } else {
            // Fallback: copy to clipboard
            navigator.clipboard.writeText(quizUrl).then(() => {
              alert('Quiz URL copied to clipboard!');
            });
          }
        }
      },
      mounted() {
        this.fetchSubmissions();
        this.fetchAssignments();
      }
    }).mount('#app');
  </script>
</body>
</html>